<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Outback Gems</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sacramento&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Allura&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Satisfy&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div id="page-wrapper">
  <header>
    <nav>    
        <div class="main-logo">
          <img src="images/logo.png" alt="Outback Gems Logo" class="logo" />
          <h1 class="welcome-message">Outback Gems & Minerals</h1>
        </div>

        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li class="dropdown">
            <a href="products.html" class="active">Products</a>
            <ul class="dropdown-menu">
              <li><a href="rough-section.html" class="dropdown-header">Rough</a></li>
              <li><a href="rough-sapphire.html">Sapphire</a></li>
              <li><a href="rough-cz.html">Cubic Zirconia</a></li>
              <li><a href="rough-spinel.html">Spinel Rough</a></li>
              <li><a href="rough-zircon.html">Zircon</a></li>
              <li><a href="other-items.html" class="dropdown-header">Other Items</a></li>
              <li><a href="wash-bags.html">Fossicking Wash Bags</a></li>
              <li><a href="thunder-eggs.html">Agate Thunder Eggs</a></li>
              <li><a href="meteorites.html">Meteorites</a></li>
              <li><a href="fluorescents.html">Fluorescent Minerals</a></li>
              <li><a href="mystery-boxes.html">Mystery Mineral Boxes</a></li>
            </ul>
          </li>
          <li><a href="gallery.html">Gallery</a></li>
          <li><a href="contact.html">Contact Us</a></li>
        </ul>

        <div class="nav-search">
          <input type="text" placeholder="Search..." />
          <button><i class="fa fa-search" aria-hidden="true"></i></button>
        </div>

        <div class="options">
          <ul>
            <li><i class="fa fa-user-o icon" aria-hidden="true" style="color:white"></i></li>
            <li><i class="fa fa-shopping-basket" aria-hidden="true" style="color:white"></i></li>
            <li><i class="fa fa-cog" aria-hidden="true" style="color:white"></i></li>
          </ul>
        </div>
    </nav>
  </header>

  <div class="page-layout">

  <div class="side-menu">
    <!-- Same menu structure kept intact -->
    <div class="side-menu-heading">Lab-Grown Rough</div>
    <div class="side-menu-container"><div class="side-menu-toggle">Sapphire</div>
      <ul class="side-menu-sublist">
        <li><a href="#">Blue Sapphire</a></li>
        <li><a href="#">Pink Sapphire</a></li>
        <li><a href="#">Yellow Sapphire</a></li>
        <li><a href="#">Green Sapphire</a></li>
        <li><a href="#">Orange Sapphire</a></li>
        <li><a href="#">Teal Sapphire</a></li>
      </ul>
    </div>

    <div class="side-menu-container"><div class="side-menu-toggle">Spinel</div>
      <ul class="side-menu-sublist">
        <li><a href="#">Red Spinel</a></li>
        <li><a href="#">Pink Spinel</a></li>
        <li><a href="#">Blue Spinel</a></li>
        <li><a href="#">Lavender Spinel</a></li>
        <li><a href="#">Green Spinel</a></li>
        <li><a href="#">Orange Spinel</a></li>
      </ul>
    </div>

    <div class="side-menu-container"><div class="side-menu-toggle">Cubic Zirconia</div>
      <ul class="side-menu-sublist">
        <li><a href="#">White CZ</a></li>
        <li><a href="#">Pink CZ</a></li>
        <li><a href="#">Champagne CZ</a></li>
        <li><a href="#">Green CZ</a></li>
        <li><a href="#">Lavender CZ</a></li>
        <li><a href="#">Orange CZ</a></li>
      </ul>
    </div>

    <div class="side-menu-heading">Natural Rough</div>
    <div class="side-menu-container"><div class="side-menu-toggle">Sapphire</div>
      <ul class="side-menu-sublist">
        <li><a href="#">Blue Sapphire</a></li>
        <li><a href="#">Green Sapphire</a></li>
        <li><a href="#">Yellow Sapphire</a></li>
        <li><a href="#">Teal Sapphire</a></li>
        <li><a href="#">Parti Sapphire</a></li>
        <li><a href="#">Pink Sapphire</a></li>
      </ul>
    </div>
    <div class="side-menu-toggle">Topaz</div>
    <div class="side-menu-toggle">Garnet</div>
    <div class="side-menu-toggle">Spinel</div>
    <div class="side-menu-toggle">Zircon</div>
    <div class="side-menu-toggle">Quartz</div>
    <div class="side-menu-toggle">Peridot</div>
    <div class="side-menu-toggle">Tourmaline</div>
    <div class="side-menu-toggle">Beryl</div>
    <div class="side-menu-toggle">Opal</div>

    <div class="side-menu-heading">Other items</div>
    <div class="side-menu-toggle">Fossicking Wash Bags</div>
    <div class="side-menu-toggle">Agate Thunder Eggs</div>
    <div class="side-menu-toggle">Meteorites</div>
    <div class="side-menu-toggle">Fluorescent Minerals</div>
    <div class="side-menu-toggle">Mystery Boxes</div>
  </div>

  <div class="view-product-container">
    <!-- Dynamic product details will be loaded here -->
    <div id="view-product-details" class="view-product-detail">
      <h1 id="product-name">Product Name</h1>
      <img id="product-image" src="" alt="Product Image" />
      <p id="product-description">Product Description</p>
      <p id="product-price">Price: $XX.XX per unit</p>
      <button id="add-to-cart">Add to Cart</button>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('productid');
  
    let currentProduct = null;
  
    const productDetailsContainer = document.getElementById('view-product-details');
  
    if (productId) {
      // Show loading indicator
      productDetailsContainer.innerHTML = '<p>Loading product details...</p>';
  
      // Fetch product details from the API
      fetch('https://script.google.com/macros/s/AKfycbyCY8VW0D1A7AFJiU7X6tN5-RTrnYxQIV4QCzmFprxYrCVv2o4uKWnmKfJ6Xh40H4uqXA/exec')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch product details.');
          }
          return response.json();
        })
        .then(data => {
          currentProduct = data.find(item => item['product id'] === productId);
  
          if (currentProduct) {
            // Find all products in the same category
            const variations = data.filter(item => item.category === currentProduct.category);
  
            // Render product details
            const imageUrl = currentProduct['image url'] || 'images/placeholder.png'; // Fallback for missing image URL
  
            productDetailsContainer.innerHTML = `
              <h1 id="product-name">${currentProduct['product name']}</h1>
              <img id="product-image" src="${imageUrl}" alt="${currentProduct['product name']}" />
              <p id="product-description">${currentProduct.description}</p>
              <p id="product-price">Price: $${currentProduct['price per unit']} per ${currentProduct.unit}</p>
              <label for="quantity">Quantity:</label>
              <input type="number" id="quantity" name="quantity" min="1" value="1" />
              <button id="add-to-cart">Add to Cart</button>
            `;
  
            // Create variation selector if there are multiple variations
            if (variations.length > 1) {
              createVariationSelector(variations, currentProduct['product id']);
            }
  
            // Add event listener for "Add to Cart" button
            document.getElementById('add-to-cart').addEventListener('click', () => {
              const quantity = parseInt(document.getElementById('quantity').value, 10);
              const stock = parseInt(currentProduct.stock, 10) || 0; // Ensure stock is a valid number
              const cart = JSON.parse(localStorage.getItem('cart')) || [];
              const existingItem = cart.find(item => item.id === currentProduct['product id']);
              const quantityInCart = existingItem ? existingItem.quantity : 0;
              const remainingStock = stock - quantityInCart;
  
              if (quantity > remainingStock) {
                alert(`Only ${remainingStock} units are available in stock.`);
                return;
              }
  
              if (existingItem) {
                existingItem.quantity += quantity;
              } else {
                cart.push({
                  id: currentProduct['product id'],
                  name: currentProduct['product name'],
                  price: parseFloat(currentProduct['price per unit']),
                  image: currentProduct['image url'] || 'images/placeholder.png',
                  quantity: quantity
                });
              }
  
              localStorage.setItem('cart', JSON.stringify(cart));
              alert(`${quantity} x ${currentProduct['product name']} has been added to your cart!`);
              updateStockQty(currentProduct); // Update stock display after adding to cart
            });
  
            // Insert stock and total price information
            insertTotalPriceElement();
            insertStockQtyElement();
            updateTotalPrice(currentProduct);
            updateStockQty(currentProduct);
          } else {
            console.error('Product not found');
            productDetailsContainer.innerHTML = `
              <p style="color: red;">Product not found. Please check the URL or try again later.</p>
              <img src="images/placeholder.png" alt="Placeholder Image" style="width: 100%; max-width: 300px; margin-top: 20px;" />
            `;
          }
        })
        .catch(error => {
          console.error('Error fetching product details:', error);
          productDetailsContainer.innerHTML = `
            <p style="color: red;">Failed to load product details. Please try again later.</p>
            <img src="images/placeholder.png" alt="Placeholder Image" style="width: 100%; max-width: 300px; margin-top: 20px;" />
          `;
        });
    } else {
      console.error('No product ID in URL');
      productDetailsContainer.innerHTML = `
        <p style="color: red;">No product selected. Please go back and choose a product.</p>
        <img src="images/placeholder.png" alt="Placeholder Image" style="width: 100%; max-width: 300px; margin-top: 20px;" />
      `;
    }
  
    function createVariationSelector(variations, selectedId) {
      const selectorContainer = document.createElement('div');
      selectorContainer.classList.add('variation-selector');
  
      const label = document.createElement('label');
      label.setAttribute('for', 'variation-select');
      label.textContent = 'Choose a variation:';
      label.style.color = 'white';
      selectorContainer.appendChild(label);
  
      const select = document.createElement('select');
      select.id = 'variation-select';
      select.style.marginLeft = '10px';
      select.style.padding = '5px';
  
      variations.forEach(product => {
        const option = document.createElement('option');
        option.value = product['product id'];
  
        const weight = product['weight'];
        const unit = product['unit'];
  
        if (weight && unit) {
          option.textContent = `${weight} ${unit}`;
        } else {
          option.textContent = unit || 'Option';
        }
  
        if (product['product id'] === selectedId) {
          option.selected = true;
        }
  
        select.appendChild(option);
      });
  
      select.addEventListener('change', (e) => {
        const selectedProduct = variations.find(p => p['product id'] === e.target.value);
        if (selectedProduct) {
          currentProduct = selectedProduct; // Update the current product
          document.getElementById('product-name').textContent = selectedProduct['product name'];
          document.getElementById('product-image').src = selectedProduct['image url'];
          document.getElementById('product-description').textContent = selectedProduct.description;
          document.getElementById('product-price').textContent = `Price: $${selectedProduct['price per unit']} per ${selectedProduct.unit}`;
          updateStockQty(selectedProduct); // Update stock display for the selected variation
        }
      });
  
      selectorContainer.appendChild(select);
      document.getElementById('view-product-details').insertBefore(selectorContainer, document.getElementById('product-price'));
    }
  
    function insertTotalPriceElement() {
      let totalPriceElement = document.getElementById('total-price');
      if (!totalPriceElement) {
        totalPriceElement = document.createElement('div');
        totalPriceElement.id = 'total-price';
        totalPriceElement.style.marginTop = '10px';
        totalPriceElement.style.color = 'white';
        document.getElementById('product-price').after(totalPriceElement);
      }
    }
  
    function insertStockQtyElement() {
      let stockQtyElement = document.getElementById('stock-qty');
      if (!stockQtyElement) {
        stockQtyElement = document.createElement('div');
        stockQtyElement.id = 'stock-qty';
        stockQtyElement.style.marginTop = '5px';
        stockQtyElement.style.color = 'white';
        document.getElementById('total-price').after(stockQtyElement);
      }
    }
  
    function updateTotalPrice(product) {
      const pricePerUnit = parseFloat(product['price per unit']);
      const weight = parseFloat(product['weight']);
  
      let totalPrice = pricePerUnit;
  
      if (!isNaN(pricePerUnit) && !isNaN(weight)) {
        totalPrice = pricePerUnit * weight;
      }
  
      const totalPriceElement = document.getElementById('total-price');
      if (totalPriceElement) {
        totalPriceElement.textContent = `Total: $${totalPrice.toFixed(2)}`;
      }
    }
  
    function updateStockQty(product) {
      const stockQtyElement = document.getElementById('stock-qty');
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingItem = cart.find(item => item.id === product['product id']);
      const quantityInCart = existingItem ? existingItem.quantity : 0;
      const remainingStock = (product.stock || 0) - quantityInCart;
  
      if (stockQtyElement) {
        stockQtyElement.textContent = `Qty in stock: ${remainingStock}`;
      }
    }
  </script>
  
     </div> <!-- End of page-wrapper -->
  <footer>
    <div class="footer-left">
      <p><a href="Privacy Policy.docx" target="_blank">Privacy Policy</a></p>
      <p><a href="Terms of Use.docx" target="_blank">Terms Of Use</a></p>
    </div>
    <div class="footer-middle">
      <p>&copy; 2025 Outback Gems & Minerals. All rights reserved.</p>
      <P>ABN: 0123456789</P>
    </div>
    <div class="footer-right">
      <p><a href="mailto:outbackgems@outlook.com"><i class="fa fa-envelope" aria-hidden="true" style="color:white"></i></a></p>
      <p><a href="https://www.facebook.com/"><i class="fa fa-facebook-square" aria-hidden="true" style="color:white"></i></a></p>
    </div>
  </footer>
 
</body>
</html>