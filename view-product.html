<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Product - Outback Gems</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sacramento&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Allura&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Satisfy&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div id="page-wrapper">
    <header id="navbar-container"></header>

    <div class="page-layout">
      <div class="side-menu">
        <!-- Same menu structure kept intact -->
        <div class="side-menu-heading">Lab-Grown Rough</div>
        <div class="side-menu-container">
          <div class="side-menu-toggle">Sapphire</div>
          <ul class="side-menu-sublist">
            <li><a href="#">Blue Sapphire</a></li>
            <li><a href="#">Pink Sapphire</a></li>
            <li><a href="#">Yellow Sapphire</a></li>
            <li><a href="#">Green Sapphire</a></li>
            <li><a href="#">Orange Sapphire</a></li>
            <li><a href="#">Teal Sapphire</a></li>
          </ul>
        </div>

        <div class="side-menu-container">
          <div class="side-menu-toggle">Spinel</div>
          <ul class="side-menu-sublist">
            <li><a href="#">Red Spinel</a></li>
            <li><a href="#">Pink Spinel</a></li>
            <li><a href="#">Blue Spinel</a></li>
            <li><a href="#">Lavender Spinel</a></li>
            <li><a href="#">Green Spinel</a></li>
            <li><a href="#">Orange Spinel</a></li>
          </ul>
        </div>

        <div class="side-menu-container">
          <div class="side-menu-toggle">Cubic Zirconia</div>
          <ul class="side-menu-sublist">
            <li><a href="#">White CZ</a></li>
            <li><a href="#">Pink CZ</a></li>
            <li><a href="#">Champagne CZ</a></li>
            <li><a href="#">Green CZ</a></li>
            <li><a href="#">Lavender CZ</a></li>
            <li><a href="#">Orange CZ</a></li>
          </ul>
        </div>

        <div class="side-menu-heading">Natural Rough</div>
        <div class="side-menu-container">
          <div class="side-menu-toggle">Sapphire</div>
          <ul class="side-menu-sublist">
            <li><a href="#">Blue Sapphire</a></li>
            <li><a href="#">Green Sapphire</a></li>
            <li><a href="#">Yellow Sapphire</a></li>
            <li><a href="#">Teal Sapphire</a></li>
            <li><a href="#">Parti Sapphire</a></li>
            <li><a href="#">Pink Sapphire</a></li>
          </ul>
        </div>
        <div class="side-menu-toggle">Topaz</div>
        <div class="side-menu-toggle">Garnet</div>
        <div class="side-menu-toggle">Spinel</div>
        <div class="side-menu-toggle">Zircon</div>
        <div class="side-menu-toggle">Quartz</div>
        <div class="side-menu-toggle">Peridot</div>
        <div class="side-menu-toggle">Tourmaline</div>
        <div class="side-menu-toggle">Beryl</div>
        <div class="side-menu-toggle">Opal</div>

        <div class="side-menu-heading">Other items</div>
        <div class="side-menu-toggle">Fossicking Wash Bags</div>
        <div class="side-menu-toggle">Agate Thunder Eggs</div>
        <div class="side-menu-toggle">Meteorites</div>
        <div class="side-menu-toggle">Fluorescent Minerals</div>
        <div class="side-menu-toggle">Mystery Boxes</div>
      </div>

      <div class="view-product-container">
        <!-- Dynamic product details will be loaded here -->
        <div id="view-product-details" class="view-product-detail">
          <h1 id="product-name">Loading...</h1>
          <img id="product-image" src="" alt="Product Image" />
          <p id="product-description">Loading product description...</p>
          <!-- Dynamically added elements (variation selector, price, weight, stock) will go here -->
          <input type="number" id="quantity" name="quantity" min="1" value="1" style="display: inline-block;" />
          <button id="add-to-cart">Add to Cart</button>
        </div>
      </div>
    </div> <!-- End of page-layout -->

    <script src="view-product.js"></script>
    <script>
      // Function to add an item to the cart
  function addToCart(item) {
const cart = JSON.parse(localStorage.getItem("cart")) || [];
const existingItem = cart.find(cartItem => cartItem.id === item.id);

if (existingItem) {
existingItem.quantity += item.quantity;
} else {
cart.push(item);
}

localStorage.setItem("cart", JSON.stringify(cart));

// Dispatch the custom "cartUpdated" event
const totalItems = cart.reduce((sum, cartItem) => sum + cartItem.quantity, 0);
document.dispatchEvent(new CustomEvent("cartUpdated", { detail: { totalItems } }));
console.log("cartUpdated event dispatched:", totalItems);

// Explicitly update the dropdown after the cart is updated
updateCartDropdown();

}
</script>
    <script>
      // Function to update the cart count
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCountElement = document.getElementById("cart-count");

        if (cartCountElement) {
          cartCountElement.textContent = totalItems;
        } else {
          console.error("Cart count element not found in the navbar.");
        }
      }

      // Function to update the cart dropdown
      function updateCartDropdown() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemsList = document.getElementById("cart-items-list");
        const cartMessage = document.getElementById("cart-message");
        const cartSubtotal = document.getElementById("cart-subtotal");
        const cartTotal = document.getElementById("cart-total");

        if (!cartItemsList || !cartMessage || !cartSubtotal || !cartTotal) {
          console.error("Cart dropdown elements not found in the DOM.");
          return;
        }

        if (cart.length === 0) {
          cartMessage.textContent = "Your cart is empty.";
          cartItemsList.innerHTML = "";
          cartSubtotal.textContent = "$0.00";
          cartTotal.textContent = "$0.00";
          return;
        }

        let subtotal = 0;
        cartItemsList.innerHTML = ""; // Clear existing items

        cart.forEach(item => {
          const itemTotal = item.price * item.quantity;
          subtotal += itemTotal;

          const cartItem = document.createElement("div");
          cartItem.classList.add("cart-item");

          cartItem.innerHTML = `
            <img src="${item.image}" alt="${item.name}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
            <div class="cart-item-details">
              <span class="product-name">${item.name}</span>
              <span class="product-code">Code: ${item.id}</span>
              <span class="product-quantity">Qty: ${item.quantity}</span>
            </div>
            <div class="cart-item-price">$${(item.price * item.quantity).toFixed(2)}</div>
          `;

          cartItemsList.appendChild(cartItem);
        });

        cartMessage.textContent = `You currently have ${cart.length} items in your cart.`;
        cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;
        cartTotal.textContent = `$${subtotal.toFixed(2)}`;
      }

      // Attach the "Add to Cart" button functionality
      document.addEventListener("DOMContentLoaded", () => {
        fetch("navbar.html")
          .then(response => {
            if (!response.ok) {
              throw new Error(`Failed to load navbar. Status: ${response.status}`);
            }
            return response.text();
          })
          .then(html => {
            const navbarContainer = document.querySelector("header") || document.getElementById("navbar-container");
            if (navbarContainer) {
              navbarContainer.innerHTML = html;

              // Force update the cart dropdown after the navbar is loaded
              updateCartCount(); // Update the cart count
              updateCartDropdown(); // Update the cart dropdown
              console.log("Cart dropdown and count updated after navbar load.");
            }
          })
          .catch(error => {
            console.error("Error loading navbar:", error);
          });

        // Wait for the product details to load before attaching the event listener
        const addToCartButton = document.getElementById("add-to-cart");
        if (addToCartButton) {
          addToCartButton.addEventListener("click", () => {
            const productNameElement = document.getElementById("product-name");
            const productPriceElement = document.getElementById("product-price");
            const productImageElement = document.getElementById("product-image");
            const quantityElement = document.getElementById("quantity");

            // Ensure all required elements exist
            if (!productNameElement || !productPriceElement || !productImageElement || !quantityElement) {
              console.error("One or more product elements are missing in the DOM.");
              return;
            }

            // Create the item object
            const item = {
              id: "1", // Replace with the actual product ID
              name: productNameElement.textContent,
              price: parseFloat(productPriceElement.textContent.replace("$", "")),
              image: productImageElement.src,
              quantity: parseInt(quantityElement.value, 10),
            };

            // Add the item to the cart
            addToCart(item);
          });
        } else {
          console.error("Add to Cart button not found in the DOM.");
        }
      });

      document.addEventListener("cartUpdated", (e) => {
  updateCartCount();
  updateCartDropdown();
});

    </script>

    <footer>
      <div class="footer-left">
  y      <p><a href="Privacy Policy.docx" target="_blank">Privacy Policy</a></p>
        <p><a href="Terms of Use.docx" target="_blank">Terms Of Use</a></p>
      </div>
      <div class="footer-middle">
        <p>&copy; 2025 Outback Gems & Minerals. All rights reserved.</p>
        <P>ABN: 0123456789</P>
      </div>
      <div class="footer-right">
        <p><a href="mailto:outbackgems@outlook.com"><i class="fa fa-envelope" aria-hidden="true" style="color:white"></i></a></p>
        <p><a href="https://www.facebook.com/"><i class="fa fa-facebook-square" aria-hidden="true" style="color:white"></i></a></p>
      </div>
    </footer>
  </div> <!-- End of page-wrapper -->
</body>
</html>